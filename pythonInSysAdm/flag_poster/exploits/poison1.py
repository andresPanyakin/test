#-*- coding: utf-8 -*-

##	\file	poison1.py
##	\brief	Тестовая реализация ядовитого класса

import base
import random
import string
import hashlib
from socket import *


def gen_data(length=8, chars=string.letters + string.digits):
	return ''.join([random.choice(chars) for i in range(length)])


class Poison1( base.PoisonBase ):
	def __init__( self ):
		self.name = 'poison1'
		pass
	
	def run ( self, addr ):
		"""
		\brief	run - главная функция ядовитого класса
				Пока функция генерирует рандомную дату и возвращает хэш от нее как флаг
		\param	addr - адрес. с которым будем работать
		"""
		ret = ''
		s = socket()
		dst = (addr, 31337)
		s.connect(dst)
		s.send('a')
		ret = s.recv(1024)
		if ret == '':
			return 'a'
		for i in range(1, 255):
			for j in ret:
				try:
					res += chr(ord(j)^i)
				except:
					print "failed to process: %s" 
			print "key: %s, res: %s" % (i, res)
		s.close()
		return ret
